### AOP

* AOP介绍
* AOP应用

<https://blog.csdn.net/jw_66666/article/details/123164325>

#### 1、什么是AOP? OOP?

AOP是Aspect Oriented Programming，即面向切面编程。OOP 即面向对象编程。OOP主张将功能模块化，对象化；而AOP主张针对同一类问题的统一处理，通过预编
译或运行时实现程序功能。

#### 2、使用场景

包括但不局限于下面几种

- 统计埋点
- 日志打印/打点
- 数据校验
- 行为拦截 (登录判断)
- 性能监控 (监控(启动时间，路径，日志)、时间抖动)
- 动态权限控制 (权限验证)

##### 3、AOP的好处

* 方便，可以少些很多代码
* 提高代码复用性
* 解耦

#### 4、AOP实现(编译时织入、运行时织入)

AOP实现方式可分2大类，一种是动态代理(运行时)，一种是静态织入(编译时)。

##### 动态代理：

> 利用拦截的方式，对类、对象、方法等信息进行装饰，以取代原有对象属性、行为的执行(或称hook)。作用期在运行时，类加载后。比较
> 知名的hook框架有：`Dexposed`,`Xposed`,`epic`

##### 静态织入：

> 在编译期，通过特定方式(框架)注入逻辑到.java文件、或.class文件或.dex文件。常见的有APT、AspectJ、Asm等

#### 各大AOP实现具体介绍

##### 动态Hook

`Dexposed`,`Xposed`,`epic`

##### APT

在编译期间通过注解生成java文件代码，所有文件尚未编译成.class文件。优点包括：

* 可以生成任何代码模板，织入所有类

缺陷：

* 会产生大量代理类
* 代码模板可能需要手动拼接(有javapoet框架完善)
* 无法修改类，只能生成类

总结：无情的代码生成工具。

[关于APT详细看这里](构建技术之APT.md)

##### AspectJ

在编译期(.java -> .class时)的代码织入框架。优点：

* 使用简单
* 功能强大，除了做hook拦截，还可以为目标类添加变量，接口

缺陷：

* 依赖方法不够简便(现阶段有集成工具直接使用，不用自己手动配置)
* 切入点固定，不够灵活
* 正则表达式 (比如切点是一个叫"onCreate()"的方法，那么所有叫onCreate()的方法都会命中)
* 性能偏低

[AspectJ介绍](AOP之AspectJ介绍.md)   
[AspectJ简单使用](AOP之AspectJ简单使用.md)

##### Javassist

修改字节码框架，在编译期(.class -> .dex **尚未编译成.dex之前**)，发挥作用。可以绕过编译，直接操作字节码。在已经编译好的类中添加方法，
或者是修改方法，从而实现代码注入。一般配合 Gradle Transform 使用。因为Transform注册便会自动添加到Task执行序列中，并且正好是项目被打
包成dex之前。Javassist对比AspectJ、APT：

* 操作灵活
* 功能更强

因为是直接操作字节码，可操作空间更大，范围更广，可以做很多突破限制的事情。对比同一级别的ASM：

* 使用难度较低(有源代码级别API，不需要了解很多的字节码知识)
* 效率低于ASM(使用反射)

[更多Javassist](AOP之Javassist介绍.md)

##### Asm

同Javassist一样，也是字节码修改工具，在编译期织入字节码。也常常联合 Gradle Transform使用。比Javassist：

* 使用难度高，需要熟悉字节码语法，学习成本高

但也有自己的优势：

* 性能更好，效率更高

[](AOP之ASM.md)


