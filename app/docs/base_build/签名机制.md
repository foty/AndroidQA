### APK签名机制

* APK签名产生
* APK实现签名的方法
* APK的签名机制

### 签名产生
> 签名可说是一种身份认证。签名包括开发者(企业)的部分信息，证明对apk的所属权。而且在android设备上，没有签名的apk是无法被安装的；应用的升级更新也要求新
> 老版本的签名相同。


#### 签名方法
android中APK签名工具包含2种(jarsigner与apksigner)，分别对应着V1与V2类型。从Android7.0开始，谷歌增加新签名方案V2。但Android 7.0以下版本，只能
用旧签名方案V1。apksigner工具默认同时使用V1和V2签名,以兼容Android 7.0以下版本。到android9.0，引入V3签名。  

V1签名:
> 来自JDK(jarsigner), 对zip压缩包的每个文件进行验证, 签名后还能对压缩包修改(移动/重新压缩文件)对V1签名的apk/jar解压,在META-INF存放签
> 名文件(MANIFEST.MF, CERT.SF, CERT.RSA), 其中MANIFEST.MF文件保存所有文件的SHA1指纹(除了META-INF文件), 由此可知: V1签名是对压缩
> 包中单个文件签名验证。

V2签名:
> 来自Google(apksigner), 对zip压缩包的整个文件验证, 签名后不能修改压缩包(包括zipalign), 对V2签名的apk解压,没有发现签名文件,重新压
缩后V2签名就失效, 由此可知: V2签名是对整个APK签名验证2签名优点很明显:
* 签名更安全(不能修改压缩包)
* 签名验证时间更短(不需要解压验证)，因而安装速度加快

V3签名：
> 基于V2签名(也是使用apksigner)，增加支持秘钥轮转。


##### 签名机制
> 

**V1签名**  
v1签名是基于jar签名来实现(jarsigner，jdk工具)，而jar的签名机制，则是往zip文件中，插入一个META-INFO文件夹，然后将所有与签名相关的信息都保存在这个文件
夹下。同样，通过对比已签名和未签名apk解压后的META-INFO文件夹下的文件。


**V2签名**  


**V3签名**  


签名机制<https://blog.csdn.net/WHHGARSKY/article/details/105546983> 
<https://blog.csdn.net/weixin_39943750/article/details/111182101>